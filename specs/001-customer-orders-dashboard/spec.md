# Feature Specification: Личный кабинет покупателя — дашборд заказов и детали

**Feature Branch**: `001-customer-orders-dashboard`  
**Created**: 2025-11-03  
**Status**: Draft  
**Input**: User description: "Личный кабинет покупателя: дашборд со списком заказов и общей суммой, список всех ранее купленных товаров по позициям (с количеством), просмотр деталей заказа (товары с картинкой, названием, количеством и ценой)."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Просмотр дашборда заказов (Priority: P1)

Покупатель открывает личный кабинет и видит дашборд: список своих заказов и агрегированную «Общую сумму заказанного» по всем релевантным заказам.

**Why this priority**: Дашборд — первый экран и основная ценность личного кабинета: контроль заказов и суммы расходов.

**Independent Test**: Можно протестировать автономно открытием дашборда под покупателем с тестовыми заказами и сверкой списка и суммы.

**Acceptance Scenarios**:

1. **Given** у пользователя есть 3 завершённых заказа, **When** он открывает дашборд, **Then** он видит список из 3 заказов и корректную общую сумму.
2. **Given** у пользователя нет заказов, **When** он открывает дашборд, **Then** он видит пустое состояние с понятным сообщением и нулевой суммой.
3. **Given** один заказ в статусе отменён, **When** пользователь открывает дашборд, **Then** отменённые и возвращённые заказы не учитываются в списке и в общей сумме; отображаются только завершённые/оплаченные.

---

### User Story 2 - Список ранее купленных товаров (Priority: P2)

Покупатель видит на дашборде/в отдельном блоке линейный список всех ранее купленных товаров с накопленным количеством по каждой позиции.

**Why this priority**: Упрощает повторные покупки и анализ истории.

**Independent Test**: Сгенерировать историю заказов с повторяющимися товарами и проверить агрегацию количеств по товару.

**Acceptance Scenarios**:

1. **Given** в истории покупок товар A куплен 3 раза по 1 шт и 1 раз 2 шт, **When** пользователь открывает список, **Then** товар A отображается с количеством 5.
2. **Given** товары имеют разные варианты/SKU, **When** отображается список, **Then** агрегирование выполняется по карточке товара (варианты/SKU суммируются как один товар).
3. **Given** нет покупок, **When** пользователь открывает список, **Then** показывается пустое состояние без ошибок.

---

### User Story 3 - Просмотр деталей заказа (Priority: P3)

Покупатель открывает любой заказ из списка и видит: перечень товаров с картинкой, названием, количеством и ценой (на момент покупки), а также итоги по заказу.

**Why this priority**: Позволяет пользователю проверять состав заказа и финансовые детали.

**Independent Test**: Открыть заказ с несколькими позициями; сверить отображение атрибутов и итогов.

**Acceptance Scenarios**:

1. **Given** заказ содержит 2 позиции, **When** пользователь открывает детали, **Then** для каждой позиции отображаются изображение, название, qty и цена, а итог заказа корректен.
2. **Given** у позиции отсутствует изображение, **When** заказ открыт, **Then** показывается понятный плейсхолдер вместо изображения.
3. **Given** используется мультивалюта, **When** заказ открыт, **Then** все значения показываются только в валюте заказа; округление банковское до 2 знаков.

---

### Edge Cases

- Нет заказов/пустая история — корректные пустые состояния на всех экранах.
- Очень большое число заказов — пагинация/ленивая подгрузка списка.
- Отмены/возвраты — определение правил включения в списки и суммы [см. уточнение в User Story 1].
- Отсутствующие изображения товаров — плейсхолдер и доступный текст.
- Изменение цены/названия товара после покупки — в деталях показываются значения на момент заказа.
- Разные валюты и налоги — значения в валюте заказа; налоги и доставка отдельно, если применимо.
- Частично выполненные заказы — правила отображения статусов и сумм.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система должна показывать дашборд со списком заказов текущего аутентифицированного покупателя.
- **FR-002**: Система должна отображать «Общую сумму заказанного» по релевантным заказам покупателя, согласно правилам включения статусов [см. FR-010].
- **FR-003**: Список заказов должен содержать ключевые поля: номер/идентификатор, дата, статус, итоговая сумма.
- **FR-004**: Пользователь должен уметь открыть детали любого заказа со списка.
- **FR-005**: В деталях заказа по каждой позиции отображаются изображение (или плейсхолдер), название, количество и цена позиции на момент покупки; итоги заказа отображают промежуточные суммы и общий итог.
- **FR-006**: Система должна показывать список ранее купленных товаров с агрегированным количеством по каждой товарной позиции.
- **FR-007**: Агрегация покупок должна учитывать только заказы, которые считаются купленными по правилам включения статусов [см. FR-010].
- **FR-008**: При отсутствии данных (нет заказов/покупок) отображаются понятные пустые состояния без ошибок.
- **FR-009**: Список заказов должен поддерживать масштабируемость (пагинация/ленивая загрузка) для больших историй.
- **FR-010**: В «список заказов» и «общую сумму заказанного» включаются только завершённые/оплаченные заказы; отменённые и возвращённые исключаются.
- **FR-011**: Список «ранее купленных» агрегируется по карточке товара; все варианты/SKU суммируются в одну позицию.
- **FR-012**: Значения цен/сумм выводятся в валюте заказа; применяется банковское округление до 2 знаков.

### Key Entities *(include if feature involves data)*

- **Customer (Покупатель)**: владелец заказов.
- **Order (Заказ)**: статус, дата, валюта, суммы, позиции.
- **OrderItem (Позиция заказа)**: товар/вариант, количество, цена на момент покупки.
- **Product (Товар)**: название, изображение(я), единица агрегирования для списка «ранее купленных».
- **DashboardTotals**: общая сумма заказанного и производные показатели.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 95% пользователей видят дашборд со списком заказов и общей суммой менее чем за 2 секунды.
- **SC-002**: 90% пользователей успешно находят нужный заказ и открывают детали менее чем за 30 секунд.
- **SC-003**: Точность «Общей суммы заказанного» и итогов заказа — 100% по сравнению с расчётом по данным заказов.
- **SC-004**: Не менее 80% повторных покупок совершается с использованием списка «ранее купленных» (при доступности функции), в течение 60 дней после запуска.

### Assumptions

- Аутентификация и базовая навигация личного кабинета уже реализованы.
- Данные о валютах и курсах доступны и согласованы системой цен.
- Если не указано иное, «ранее купленные товары» строятся на всём горизонте истории покупок пользователя.
- Ошибки загрузки отображаются пользовательски-дружественными сообщениями, с возможностью повторной попытки.
