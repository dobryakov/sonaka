# Resource Plan: Личный кабинет покупателя — дашборд заказов

**Feature**: 001-customer-orders-dashboard  
**Дата создания**: 2025-01-27  
**Основан на**: `tasks.md`

## Легенда ролей

- **BE** - Backend Developer (Ruby on Rails, PostgreSQL)
- **FE** - Frontend Developer (React, TypeScript)
- **DevOps** - DevOps Engineer (Docker, CI/CD, инфраструктура)
- **QA** - QA Engineer (автотесты, e2e тесты)
- **DBA** - Database Developer (миграции, индексы, оптимизация БД)
- **Full-stack** - Full-stack Developer (работа с обеими частями)

## Легенда сроков

- Оценки приведены в часах (ч) или рабочих днях (дн)
- 1 рабочий день = 8 часов
- Сроки указаны для разработчика среднего уровня (middle)
- Для junior — умножить на 1.5-2, для senior — умножить на 0.7-0.8

---

## Phase 1: Setup

### T001: Создать `.env` с параметрами портов и БД
**Роли**: DevOps  
**Срок**: 1-2 ч  
**Описание**: Создание конфигурационного файла с переменными окружения

### T002 [P]: Добавить `docker-compose.yml` со службами
**Роли**: DevOps, BE (консультация)  
**Срок**: 4-6 ч  
**Описание**: Настройка docker-compose с тремя сервисами, порты >10000, переменные из .env

### T003 [P]: Создать `backend/Dockerfile` для Rails API
**Роли**: DevOps, BE (консультация)  
**Срок**: 3-4 ч  
**Описание**: Оптимизация Dockerfile, настройка production-режима, кэширование слоёв

### T004 [P]: Создать `frontend/Dockerfile` для React SPA
**Роли**: DevOps, FE (консультация)  
**Срок**: 3-4 ч  
**Описание**: Multi-stage build, оптимизация размера образа, настройка production build

### T005: Конфигурировать README раздел «Запуск»
**Роли**: Full-stack или DevOps  
**Срок**: 2-3 ч  
**Описание**: Документирование команд запуска, зависимостей, требований к окружению

---

## Phase 2: Foundational

### T006: Настроить Rails API каркас (routes, версии API)
**Роли**: BE  
**Срок**: 2-3 ч  
**Описание**: Настройка routes.rb с версионированием API, базовые контроллеры

### T007: Настроить подключение к PostgreSQL
**Роли**: BE, DBA (консультация)  
**Срок**: 2-3 ч  
**Описание**: Конфигурация database.yml, настройка пулов подключений

### T008 [P]: Определить миграции сущностей Customer, Product
**Роли**: BE, DBA (консультация)  
**Срок**: 4-6 ч  
**Описание**: Создание миграций с типами данных, валидациями на уровне БД, первичными ключами

### T009 [P]: Определить миграции сущностей Order, OrderItem (индексы)
**Роли**: BE, DBA  
**Срок**: 6-8 ч  
**Описание**: Миграции с внешними ключами, составными индексами для SC-001/002, ограничениями целостности

### T010: Добавить сиды тестовых данных
**Роли**: BE  
**Срок**: 4-6 ч  
**Описание**: Создание реалистичных тестовых данных (customers, products, orders, order_items)

### T011: Настроить фронтенд проект (React + TS)
**Роли**: FE  
**Срок**: 4-6 ч  
**Описание**: Инициализация проекта, настройка TypeScript, базовые зависимости (React Router, i18n)

### T012 [P]: Создать общий API слой и базовый клиент
**Роли**: FE  
**Срок**: 6-8 ч  
**Описание**: Абстракция для API-вызовов, обработка ошибок, базовые типы, interceptors

### T013 [P]: Настроить локализацию RU
**Роли**: FE  
**Срок**: 3-4 ч  
**Описание**: Настройка i18n библиотеки, структура файлов локализации, загрузка переводов

### T014: Подготовить общие UI-компоненты (EmptyState, LoadingSpinner)
**Роли**: FE  
**Срок**: 4-6 ч  
**Описание**: Компоненты с учетом доступности (a11y), стилизация в фирменном стиле

---

## Phase 3: User Story 1 — Дашборд заказов (P1)

### T015 [US1]: Добавить модели и валидации `Order`, `OrderItem`
**Роли**: BE  
**Срок**: 4-6 ч  
**Описание**: ActiveRecord модели с валидациями, ассоциациями, scope'ами

### T016 [P] [US1]: Реализовать сервис `DashboardTotalsCalculator`
**Роли**: BE  
**Срок**: 1.5-2 дн  
**Описание**: Бизнес-логика фильтрации статусов, исключение частичных возвратов, конвертация валют, банковское округление

### T017 [P] [US1]: Реализовать сериалайзеры `OrderSerializer`, `DashboardSerializer`
**Роли**: BE  
**Срок**: 4-6 ч  
**Описание**: Сериализация с учетом производительности, вложенные ресурсы, округление сумм

### T018 [US1]: Создать контроллер `api/v1/dashboard_controller.rb` c GET `/dashboard`
**Роли**: BE  
**Срок**: 3-4 ч  
**Описание**: Контроллер с обработкой ошибок, авторизацией, пагинацией

### T019 [P] [US1]: Обновить `routes.rb` для маршрута `/api/v1/dashboard`
**Роли**: BE  
**Срок**: 1-2 ч  
**Описание**: Добавление маршрута с версионированием, ограничениями

### T020 [US1]: Добавить запросы на стороне фронтенда `dashboardService.getDashboard()`
**Роли**: FE  
**Срок**: 2-3 ч  
**Описание**: Метод сервиса с типизацией, обработкой ошибок, пагинацией

### T021 [P] [US1]: Создать типы `Dashboard`, `OrderSummary`
**Роли**: FE  
**Срок**: 2-3 ч  
**Описание**: TypeScript интерфейсы/типы с учетом API контракта

### T022 [P] [US1]: Реализовать компоненты `DashboardTotals` и `OrdersList`
**Роли**: FE  
**Срок**: 1-1.5 дн  
**Описание**: Компоненты с фирменным стилем, анимациями, обработкой состояний загрузки/ошибок

### T023 [US1]: Создать страницу `DashboardPage.tsx` и маршрутизацию
**Роли**: FE  
**Срок**: 3-4 ч  
**Описание**: Интеграция компонентов, настройка роутинга, layout

### T024 [US1]: Добавить бесконечную ленту `useInfiniteScroll`
**Роли**: FE  
**Срок**: 4-6 ч  
**Описание**: Кастомный хук с debounce, обработкой ошибок, оптимизацией рендеринга

### T025 [US1]: Интегрировать RU-локализацию строк дашборда
**Роли**: FE  
**Срок**: 2-3 ч  
**Описание**: Добавление переводов, интеграция в компоненты

### T049 [US1]: Реализовать банковское округление (half‑to‑even)
**Роли**: BE  
**Срок**: 4-6 ч  
**Описание**: Реализация алгоритма округления в сервисе и сериалайзерах

### T050 [US1]: Написать unit‑тесты на округление (краевые кейсы .5)
**Роли**: QA, BE  
**Срок**: 3-4 ч  
**Описание**: Покрытие edge cases округления, проверка корректности алгоритма

### T051 [US1]: Unit‑тесты на точность сумм и конвертацию валют
**Роли**: QA, BE  
**Срок**: 4-6 ч  
**Описание**: Тесты на точность вычислений, конвертацию валют, граничные случаи

### T052 [US1]: Контрактные тесты `/dashboard` (мультивалюта, статусы, возвраты)
**Роли**: QA, BE  
**Срок**: 1-1.5 дн  
**Описание**: Request specs с различными сценариями, проверка статусов, мультивалютности, частичных возвратов

---

## Phase 4: User Story 2 — Ранее купленные товары (P2)

### T026 [US2]: Добавить агрегацию ранее купленных в сервисе (SQL GROUP BY product_id)
**Роли**: BE, DBA (консультация)  
**Срок**: 6-8 ч  
**Описание**: Оптимизированный SQL запрос с агрегацией, GROUP BY, оптимизация производительности

### T027 [P] [US2]: Расширить сериалайзер `DashboardSerializer` полем `previously_purchased_items`
**Роли**: BE  
**Срок**: 2-3 ч  
**Описание**: Добавление поля в сериалайзер, настройка вложенных данных

### T028 [US2]: Обновить endpoint `/dashboard` для возврата агрегата покупок
**Роли**: BE  
**Срок**: 2-3 ч  
**Описание**: Интеграция агрегации в контроллер, обновление логики

### T029 [US2]: Реализовать `dashboardService.getPreviouslyPurchased()` или использовать данные из `/dashboard`
**Роли**: FE  
**Срок**: 2-3 ч  
**Описание**: Обновление типов, обработка новых данных из API

### T030 [P] [US2]: Создать компонент `PreviouslyPurchasedList`
**Роли**: FE  
**Срок**: 6-8 ч  
**Описание**: Компонент списка с группировкой товаров, свёртыванием вариантов/SKU, стилизацией

### T031 [US2]: Добавить RU-локализацию строк ранее купленных
**Роли**: FE  
**Срок**: 1-2 ч  
**Описание**: Добавление переводов для нового функционала

---

## Phase 5: User Story 3 — Детали заказа (P3)

### T032 [US3]: Реализовать контроллер `orders_controller.rb` c GET `/orders/{order_id}`
**Роли**: BE  
**Срок**: 3-4 ч  
**Описание**: Контроллер с обработкой ошибок (404, авторизация), загрузка связанных данных

### T033 [P] [US3]: Добавить сериалайзер `OrderItemSerializer` и расширения `OrderSerializer`
**Роли**: BE  
**Срок**: 4-6 ч  
**Описание**: Детальная сериализация заказа с позициями, изображениями, ценами на момент покупки

### T034 [US3]: Обновить `routes.rb` для маршрута `/api/v1/orders/:order_id`
**Роли**: BE  
**Срок**: 1-2 ч  
**Описание**: Добавление RESTful маршрута

### T035 [P] [US3]: Реализовать `ordersService.getOrderDetails(orderId)`
**Роли**: FE  
**Срок**: 2-3 ч  
**Описание**: Метод сервиса с типизацией, обработкой ошибок

### T036 [P] [US3]: Создать компоненты `OrderDetailsView` и `OrderItemCard`
**Роли**: FE  
**Срок**: 1-1.5 дн  
**Описание**: Компоненты с отображением деталей заказа, карточек товаров, изображений/плейсхолдеров, итогов

### T037 [US3]: Создать страницу `OrderDetailsPage.tsx` и роут из списка заказов
**Роли**: FE  
**Срок**: 3-4 ч  
**Описание**: Страница деталей заказа, навигация из списка заказов, обработка состояний

### T038 [US3]: Добавить RU-локализацию строк деталей заказа
**Роли**: FE  
**Срок**: 2-3 ч  
**Описание**: Переводы для страницы деталей заказа

---

## Phase 6: Polish & Cross-Cutting

### T039: Добавить индексы БД по производительности
**Роли**: DBA, BE (консультация)  
**Срок**: 4-6 ч  
**Описание**: Анализ запросов, создание индексов на customer_id, status, order_date, has_partial_refund, композитные индексы

### T040 [P]: Включить обработку ошибок и сообщения на русском
**Роли**: BE  
**Срок**: 6-8 ч  
**Описание**: Централизованная обработка ошибок в ApplicationController, локализованные сообщения об ошибках

### T041 [P]: Доработать доступность и стили (glass-morphism, prefers-reduced-motion)
**Роли**: FE  
**Срок**: 1-1.5 дн  
**Описание**: Применение glass-morphism эффектов, поддержка prefers-reduced-motion, улучшение доступности (ARIA, keyboard navigation)

### T042: Настроить выборочный запуск автотестов (RSpec, Jest) в CI
**Роли**: DevOps, QA  
**Срок**: 6-8 ч  
**Описание**: Настройка GitHub Actions workflows с селективным запуском тестов по изменённым файлам

### T043 [P]: Добавить Docker‑сервис e2e (Playwright) в docker-compose.yml
**Роли**: DevOps, QA  
**Срок**: 4-6 ч  
**Описание**: Конфигурация Docker-сервиса для e2e тестов, подключение к frontend/backend сервисам

### T044 [P]: Инициализировать Playwright: конфиг, базовые spec'и
**Роли**: QA, FE (консультация)  
**Срок**: 1-1.5 дн  
**Описание**: Настройка Playwright, создание базовых e2e тестов для критических сценариев (US1-US3)

### T045: Настроить скрипты запуска e2e (headless) в package.json
**Роли**: DevOps, QA  
**Срок**: 2-3 ч  
**Описание**: Скрипты для локального и CI запуска e2e тестов

### T046: Включить e2e‑джобу в CI (отдельный job)
**Роли**: DevOps, QA  
**Срок**: 3-4 ч  
**Описание**: Настройка отдельной CI-джобы для e2e тестов с зависимостями от других джоб

### T047: Подготовить фикстуры/сиды для e2e и команды запуска в README
**Роли**: QA, BE  
**Срок**: 4-6 ч  
**Описание**: Создание тестовых данных для e2e, документация в README

### T048: Добавить шаг загрузки сидов в CI перед тестами
**Роли**: DevOps, BE  
**Срок**: 2-3 ч  
**Описание**: Добавление шага `rails db:prepare && rails db:seed` в CI перед запуском тестов

### T053: Сгенерировать большие тест‑данные (1M заказов) через сиды/фабрики
**Роли**: BE, DBA (консультация)  
**Срок**: 1-2 дн  
**Описание**: Создание эффективных сидов/фабрик для генерации больших объёмов данных, оптимизация производительности генерации

### T054: Добавить перф‑тесты (профилирование и p95 latency) на `/dashboard` в CI
**Роли**: DevOps, BE, QA  
**Срок**: 2-3 дн  
**Описание**: Настройка перфоманс-тестов, профилирование запросов, измерение p95 latency, интеграция в CI

### T055: Зафиксировать бюджет перфоманса и фейки данных в quickstart.md
**Роли**: BE, DevOps  
**Срок**: 2-3 ч  
**Описание**: Документирование целевых метрик производительности, инструкций по использованию тестовых данных

---

## Итоговые оценки по фазам

| Фаза | Общая длительность | Основные роли |
|------|-------------------|---------------|
| Phase 1: Setup | 13-19 ч (~2 дн) | DevOps, BE, FE |
| Phase 2: Foundational | 31-44 ч (~4-5.5 дн) | BE, FE, DBA |
| Phase 3: US1 — Дашборд | 48-65 ч (~6-8 дн) | BE, FE, QA |
| Phase 4: US2 — Ранее купленные | 17-23 ч (~2-3 дн) | BE, FE, DBA |
| Phase 5: US3 — Детали заказа | 18-24 ч (~2-3 дн) | BE, FE |
| Phase 6: Polish & Cross-Cutting | 62-86 ч (~8-11 дн) | DevOps, QA, BE, FE, DBA |
| **ИТОГО** | **189-261 ч (~24-33 раб. дн)** | - |

## Рекомендуемый состав команды

Для параллельного выполнения задач с маркировкой [P] рекомендуется:

**Минимальный состав:**
- 1 Backend Developer (BE)
- 1 Frontend Developer (FE)
- 1 DevOps Engineer (на part-time, особенно в начале проекта)
- 1 QA Engineer (на part-time, особенно в Phase 3+)

**Оптимальный состав:**
- 2 Backend Developers (BE)
- 2 Frontend Developers (FE)
- 1 DevOps Engineer
- 1 QA Engineer
- 1 DBA (на консультациях, особенно в Phase 2 и Phase 6)

## Примечания

1. **Параллелизация [P]**: Задачи с маркером [P] могут выполняться параллельно разными разработчиками, что сокращает общее время выполнения фазы.

2. **Зависимости**: Учитывайте зависимости между задачами (US1 → US2 → US3).

3. **Тестирование**: Рекомендуется писать тесты параллельно с разработкой функционала, а не после.

4. **Code Review**: Оценки не включают время на code review, который рекомендуется планировать дополнительно (+20-30% к срокам).

5. **Неопределённость**: Сложные задачи (например, T016, T053, T054) могут потребовать больше времени при возникновении непредвиденных проблем.

